# ELO rating experiments for problem solving

Given a collection of agents (of varying strengths) that attempt to solve a
collection of problems (of varying difficulty), one can try to rank the quality
of the agents. If agents experience downtime and don't attempt the exact same
set of problems, one can use a Bayesean model to infer some ELO-type rating for
the agents (and problems).

This project simulates this situation for experimentation with such rating
model. It consists of two python scripts

1.  `simulate.py`: Simulates a competition where agents attempt to solve problems. It outputs a JSON file detailing each attempt.
2.  `rate.py`: Takes the JSON output from `simulate.py` to rate the agents and problems based on the outcomes. It then outputs a JSON file containing these ratings.

## Rating model used

The rating model used is a Bayesian variant on chess ELO rating. It expresses
strength `s` of an agent and difficulty `d` of a problem on a numerical scale,
such that

> Probability of success = 1 / (1 + exp(d - s))

It assumes as prior that strengths and difficulties are normally distributed (with
user-provided parameters), and that the strength of an agent is *constant*.

Given the outcomes of a competition, it uses a
numerical Newton scheme to find the maximum likelihood estimates of the
strengths of agents and difficulties of problems. In particular, this also gives
uncertainty quantification of the computed ratings.

Note: To convert `s` and `d` to regular chess ELO scale, multiply by 400/log(10) ≈ 173.7
and add an arbitrary constant.

## Usage

### 1. Simulate Competition Data

The `simulate.py` script generates synthetic data of agents attempting problems.
The parameters are hard-coded as global constants, to change them edit the file.
They determine the distribution of

- the difficulties of the problems
- the strengths of the agents
- the amount of downtime of the agents

To run the simulation and generate an output file (e.g., `simulation_attempts.json`):
```bash
python simulate.py --output_file simulation_attempts.json
```
This will create `simulation_attempts.json` which encodes a list of attempts
formatted as:
```json
[
  {
    "agent": "Agent1",
    "problem": "Problem1",
    "outcome": "failed"
  },
  {
    "agent": "Agent2",
    "problem": "Problem1",
    "outcome": "solved"
  },
  // ...
]
```

Alternatively, one can produce such json from an external source of competition data.

### 2. Rate Agents and Problems

The `rate.py` script processes the data generated by `simulate.py` to infer
agent strengths and problem difficulties using a maximum likelihood estimation
for the Bradley-Terry model.


To rate the agents and problems using the output from the simulation step:
```bash
python rate.py simulation_attempts.json --output_file ratings.json
```
This command will read `simulation_attempts.json`, perform the rating calculations, and save the results to `ratings.json`.


## Example results

This experiment is to inform choices in the [SorryDB
project](https://github.com/SorryDB/SorryDB). Here is one run of the experiment:

Simulation parameters:

- 20 agents
- 1000 problems ('sorries')
- mean difficulty - mean strength = 15 (corresponding to a success rate of
  3e-07)
- std deviation of agent strength = 2.5
- std deviation of problem difficulty = 5

Outcome:

- 20 problems were solved
- 13 agents solved at least one problem

Inferred agent ratings (for default priors):

| Rank | ID  | Strength        | Solved | Attempts | Solve Rate |
|------|-----|-----------------|--------|----------|------------|
| 1    | A14 | 16.68 ± 0.70    | 5      | 324      | 0.015      |
| 2    | A20 | 16.59 ± 0.97    | 2      | 348      | 0.006      |
| 3    | A12 | 16.23 ± 0.52    | 12     | 878      | 0.014      |
| 4    | A15 | 15.00 ± 0.60    | 6      | 754      | 0.008      |
| 5    | A10 | 14.59 ± 0.69    | 5      | 589      | 0.008      |
| 6    | A5  | 14.45 ± 0.84    | 2      | 461      | 0.004      |
| 7    | A3  | 14.45 ± 1.08    | 1      | 216      | 0.005      |
| 8    | A19 | 13.51 ± 0.81    | 2      | 563      | 0.004      |
| 9    | A11 | 13.37 ± 1.08    | 1      | 385      | 0.003      |
| 10   | A6  | 13.11 ± 0.93    | 2      | 688      | 0.003      |
| 11   | A18 | 12.98 ± 1.44    | 1      | 230      | 0.004      |
| 12   | A7  | 12.90 ± 0.92    | 2      | 660      | 0.003      |
| 13   | A4  | 12.51 ± 1.29    | 1      | 650      | 0.002      |

Top/Bottom inferred problem ratings:

| Rank | ID   | Difficulty      | Solved by                              |
|------|------|-----------------|----------------------------------------|
| 1    | P722 | 17.20 ± 1.00    | A10                                    |
| 2    | P571 | 17.20 ± 1.00    | A14                                    |
| 3    | P539 | 16.95 ± 1.00    | A14                                    |
| 4    | P916 | 16.80 ± 1.04    | A12                                    |
| 5    | P159 | 16.69 ± 1.08    | A7                                     |
| ...  | ...  | ...             | ...                                    |
| 16   | P495 | 14.32 ± 0.88    | A15, A12, A6                           |
| 17   | P183 | 13.99 ± 0.97    | A5, A12, A19                           |
| 18   | P825 | 13.82 ± 1.02    | A15, A12, A10                          |
| 19   | P628 | 13.19 ± 0.88    | A11, A12, A10, A19                     |
| 20   | P352 | 10.75 ± 1.36    | A14, A15, A7, A12, A10, A18, A6, A4    |
